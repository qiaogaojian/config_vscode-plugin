(()=>{"use strict";var e={78:function(e,t){var n,i,r=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0,t.Cache=class{constructor(){n.set(this,{}),i.set(this,{})}set(e,t){r(this,n,"f")[e]=t;const o=r(this,i,"f")[e];o&&clearTimeout(o),r(this,i,"f")[e]=setTimeout((()=>{delete r(this,n,"f")[e]}),864e5)}unset(e){delete r(this,n,"f")[e];const t=r(this,i,"f")[e];t&&clearTimeout(t)}get(e){return r(this,n,"f")[e]}},n=new WeakMap,i=new WeakMap},599:function(e,t,n){var i,r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},s=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){!function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)}(i,r,(t=e[n](t)).done,t.value)}))}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigResolver=void 0;const a=n(747),c=n(225),u=n(622),l=n(549),f=n(78),d=n(593);t.ConfigResolver=class{constructor(e,t){this.configKey=e,this.possibleNames=t,i.set(this,new f.Cache)}findConfig(e){return r(this,void 0,void 0,(function*(){let t=d.getConfig(this.configKey);if(!t)return yield this.resolveConfig(e);if(!u.isAbsolute(t)){const n=l.workspace.getWorkspaceFolder(e.uri);return n?u.join(n.uri.fsPath,t):u.join(u.dirname(e.uri.fsPath),t)}return t}))}resolveConfig(e){var t,n;return r(this,void 0,void 0,(function*(){let r,l,f=o(this,i,"f").get("config");if(f&&a.existsSync(f))return f;for(let i=u.parse(e.uri.fsPath),o=0;i.root!==i.dir||o>100;i=u.parse(i.dir),o++){r=yield c.opendir(i.dir);try{for(var d,h=(t=void 0,s(r));!(d=yield h.next()).done;){const e=d.value;if(e.isFile()){const t=this.possibleNames.indexOf(e.name);t>-1&&t<(l||this.possibleNames.length)&&(l=t,f=u.join(i.dir,e.name))}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&(yield n.call(h))}finally{if(t)throw t.error}}if(f)break}return o(this,i,"f").set("config",f),f}))}},i=new WeakMap},285:function(e,t,n){var i,r=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutableResolver=void 0;const o=n(129),s=n(747),a=n(87),c=n(78);t.ExecutableResolver=class{constructor(e,t){this.name=e,this.ext=t,i.set(this,new c.Cache)}findExecutable(){return this.resolveExecutable(this.name,this.ext)}resolveExecutable(e,t){let n,c=r(this,i,"f").get("exec");if(c&&s.existsSync(c))return c;switch(a.platform()){case"win32":n="where";break;default:n="which"}return c=o.spawnSync(n,[e],{encoding:"utf-8"}).stdout,c||!t?(r(this,i,"f").set("exec",c),c.trim()):this.resolveExecutable(e+t,"")}},i=new WeakMap},23:function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.LaTeXDocumentFormatter=void 0;const c=n(129),u=n(87),l=n(549),f=n(599),d=n(285),h=n(593),p=new l.Range(0,0,Number.MAX_VALUE,Number.MAX_VALUE);class v{constructor(){i.set(this,void 0),r.set(this,void 0),s(this,i,new f.ConfigResolver(v.CONFIG,v.CONFIG_NAMES),"f"),s(this,r,new d.ExecutableResolver(v.EXECUTABLE,"win32"===u.platform()?".exe":".pl"),"f")}provideDocumentFormattingEdits(e,t){return o(this,void 0,void 0,(function*(){let n=a(this,r,"f").findExecutable();if(!n)return yield l.window.showErrorMessage(`${v.EXECUTABLE} could not be found.`),[];const o=yield a(this,i,"f").findConfig(e),{output:s,error:c}=this.execute(e,n,t,o);return c?(yield l.window.showErrorMessage(c),[]):s?[l.TextEdit.replace(e.validateRange(p),s)]:[]}))}execute(e,t,n,i){const r=["-g","/dev/null","-m"];if(i)r.push("-l",i);else{const e={defaultIndent:Array(n.insertSpaces?n.tabSize:1).fill(n.insertSpaces?" ":"\t").join(""),textWrapOptions:{columns:h.getConfig("formatter.columnLimit")}};r.push("-y",`defaultIndent:'${e.defaultIndent}',modifyLineBreaks:textWrapOptions:columns:${e.textWrapOptions.columns}`)}r.push("-");const{stdout:o,stderr:s}=c.spawnSync(t,r,{encoding:"utf-8",input:e.getText(),timeout:1e4});return{output:o.trim(),error:s}}}t.LaTeXDocumentFormatter=v,i=new WeakMap,r=new WeakMap,v.EXECUTABLE="latexindent",v.CONFIG="linter.config",v.CONFIG_NAMES=["localSettings.yaml","latexindent.yaml",".localSettings.yaml",".latexindent.yaml"]},459:function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.LaTeXDocumentLinter=void 0;const c=n(129),u=n(87),l=n(549),f=n(599),d=n(285),h={Error:l.DiagnosticSeverity.Error,Warning:l.DiagnosticSeverity.Warning,Message:l.DiagnosticSeverity.Information};class p{constructor(){i.set(this,void 0),r.set(this,void 0),s(this,i,new f.ConfigResolver(p.CONFIG,p.CONFIG_NAMES),"f"),s(this,r,new d.ExecutableResolver(p.EXECUTABLE,"win32"===u.platform()?".exe":""),"f")}provideDocumentLintingDiagnostics(e){return o(this,void 0,void 0,(function*(){const t=a(this,r,"f").findExecutable();if(!t)return yield l.window.showErrorMessage(`${p.EXECUTABLE} could not be found.`),[];const n=yield a(this,i,"f").findConfig(e),{output:o,error:s}=this.execute(e,t,n);return s?(yield l.window.showErrorMessage(s),[]):o?this.parseLintOutput(e,o):[]}))}execute(e,t,n){const i=[];n&&i.push("-l",n),i.push("-f","%k:%n:%l:%c:%d:%m\n"),i.push("-q"),i.push("-I");const{stdout:r,stderr:o}=c.spawnSync(t,i,{encoding:"utf-8",input:e.getText(),timeout:1e4});return{output:r.trim(),error:o}}parseLintOutput(e,t){const n=[];for(const i of t.trim().split("\n")){const[t,r,o,s,a,c]=i.split(":",6),u=new l.Position(+o-1,+s-1),f=e.positionAt(e.offsetAt(u)+ +a);n.push(new l.Diagnostic(new l.Range(u,f),`[${p.EXECUTABLE}] ${r}: ${c}`,h[t]))}return n}}t.LaTeXDocumentLinter=p,i=new WeakMap,r=new WeakMap,p.EXECUTABLE="chktex",p.CONFIG="linter.config",p.CONFIG_NAMES=[".chktexrc","chktexrc"]},580:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.registerDocumentLintingProvider=void 0;const r=n(549),o=n(593);t.registerDocumentLintingProvider=function(e,t){const n=e=>i(this,void 0,void 0,(function*(){const n=[];for(const i of t)n.push(...yield i.provideDocumentLintingDiagnostics(e));l.set(e.uri,n)}));let s;const a=(t,i)=>{if(o.getConfig("linter.enabled")&&r.languages.match(e,t)){if(i)return n(t);s&&clearTimeout(s),s=setTimeout((()=>n(t)),o.getConfig("linter.delay"))}};let c=r.window.activeTextEditor;c&&a(c.document,!0);const u=[],l=r.languages.createDiagnosticCollection("latex");return u.push(l),r.window.onDidChangeActiveTextEditor((t=>{c=t,t&&r.languages.match(e,t.document)&&(s&&clearTimeout(s),a(t.document))}),void 0,u),r.workspace.onDidChangeTextDocument((({document:e})=>{c&&e===c.document&&a(e)}),void 0,u),{dispose(){u.forEach((e=>e.dispose()))}}}},593:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getConfig=void 0;const i=n(549);t.getConfig=e=>i.workspace.getConfiguration("latex").get(e)},129:e=>{e.exports=require("child_process")},747:e=>{e.exports=require("fs")},225:e=>{e.exports=require("fs/promises")},87:e=>{e.exports=require("os")},622:e=>{e.exports=require("path")},549:e=>{e.exports=require("vscode")}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=n(549),r=n(23),o=n(459),s=n(580),a={scheme:"file",language:"latex"};e.activate=function(e){e.subscriptions.push(t.languages.registerDocumentFormattingEditProvider(a,new r.LaTeXDocumentFormatter)),e.subscriptions.push(s.registerDocumentLintingProvider(a,[new o.LaTeXDocumentLinter]))},e.deactivate=function(){}})(),module.exports=i})();